---
title: "Design of Experiment and Analysis of Variance"
subtitle: "Repetition"
author: "Raju Rimal"
date: "`r format(Sys.Date(), '%d %b, %Y')`"
output:
  xaringan::moon_reader:
    css: ['default', 'custom.css']
    lib_dir: libs
    chakra: 'libs/remark-latest.min.js'
    nature:
      ratio: 16:10
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(echo = FALSE, comment = NULL)
library(tidyverse)
library(gganimate)
```

background-image: url(https://www.nmbu.no/sites/all/themes/nmbu_university/images/logo-nb.png)

???

Image credit: [NMBU](https://www.nmbu.no/sites/all/themes/nmbu_university/images/logo-nb.png)

---
class: center, middle, inverse

# Statistical Inference
## Hypothesis Testing

---
class: spread

.left-column[
# Inference Steps
![](images/SimpleSampling.png)


]
.right-column[
1. Make a hypothesis

2. Collect data

3. Calculate test-statistic

4. Compare test-statistic with theoretical distribution </br>(T-statistic, F-statistic, $\chi^2$ statistic)

5. Conclusion and decision
]

---
class: spread

.left-column[
# Hypothesis
## Null Hypothesis
]

.right-column[
One sample t-test
: $H_0: \mu = 5$

Two sample t-test
: $H_0: \mu_1 = \mu_2$

ANOVA model
: $H_0: \tau_1 = \tau_2 = \tau_3 = 0$

Random effect Model
: $H_0: \sigma_\tau^2 = 0$

.red[_Always write hypothesis in terms of **population parameter**_]
]

---
class: spread

.left-column[
# Hypothesis
## Alternative Hypothesis
]

.right-column[

### One sided vs Two sided

<details>
<summary>Test if expected variance of \(x\) is greater than 11.</summary>
\[H_1: \sigma > 11\]
</details>

<details>
<summary>Are the three soya groups significantly different?</summary>
\[H_1: \mu_i \ne \mu_j \text{ for any } i \ne j\]
If \(\tau_i = \mu_i - \mu\) is the effect of group \(i\),
\[H_1: \tau_i \ne 0 \text{ for at least one } i = 1, 2, 3\]
</details>

<details>
<summary>Can we conclude that the average of `soya` diet gives higher protein than `non-soya` diet?</summary>
\[H_1: \Gamma < 0 \text{ where, } \Gamma = \tau_1 - \frac{1}{2}(\tau_2 + \tau_3)\]
</details>

<details>
<summary>Does fat percent vary accross these randomly chosen farms?</summary>
\[H_1: \sigma_\tau^2 > 0\]
</details>
]

---

.left-column[
# Test Statistic
## T-test

```{r, echo = FALSE, fig.width=4, out.width='100%', fig.asp=0.7, fig.retina=2}
d <- 18
alpha <- 0.025
lmt <- 4
t_plot <- ggplot(data.frame(x = -lmt:lmt), aes(x)) +
  stat_function(fun = dt, args = list(df = d)) +
  stat_function(fun = dt, args = list(df = d), 
                xlim = c(-lmt, qt(alpha, df = d, FALSE)), 
                geom = "area") +
  stat_function(fun = dt, args = list(df = d), 
                xlim = c(-1 * qt(alpha, df = d, FALSE), lmt), 
                geom = "area") +
  stat_function(fun = dt, args = list(df = d), 
                xlim = c(-1 * qt(alpha, df = d, FALSE), lmt)) +
  ggtitle(paste("T-distribution with", d, 
                "df"),
          paste(alpha * 2, "level of significance")) +
  labs(x = "T", y = NULL) +
  annotate(x = c(1, -1) * qt(alpha, df = d, FALSE), 
           color = "red",
           ymin = 0, ymax = 0.07, geom = "linerange") +
  annotate(x = c(1, -1) * qt(alpha, df = d, FALSE), 
           label = paste("t = ", c(1, -1) * round(qt(alpha, df = d, FALSE), 3)), geom = "text", y = 0.08, hjust = c(1, 0))
```

```{r, fig.width=3.5, out.width='90%', fig.asp = 1, fig.retina=2}
t_plot
```

<div class="side-caption">The .italics[darker region] under the curve is .italics[rejection region]. If the calculated t-value lies in this region, we reject Null hypothesis.</div>
]

.right-column[

### One sample test
$$\text{t-statistic} = \dfrac{\bar{y}}{\mathrm{SE}(\bar{y})} = \dfrac{\bar{y}}{\hat{\sigma}/\sqrt{n}} \sim t_{\alpha/2, n-1}$$
### Difference between two groups 
$$\text{t-statistic} = \dfrac{\bar{y}_i - \bar{y}_j}{\mathrm{SE}(\bar{y}_i - \bar{y}_j)} = \dfrac{\bar{y}_i - \bar{y}_j}{S_p\sqrt{\cfrac{1}{n_1} + \cfrac{1}{n_2}}} \sim t_{\alpha/2, N-a}$$
### C.I. true difference between two groups
$$\left[\bar{y}_i - \bar{y}_j \pm t_{\alpha/2, N-a} \times S_p\sqrt{\cfrac{1}{n_1} + \cfrac{1}{n_2}} \right]$$
]


---

.left-column[
# Test Statistic
## Example
```{r, fig.width=3, out.width='90%', fig.asp = 1, fig.retina=2}
load("../_data/Portlandcement.RData")
cement <- gather(Portlandcement)
plt <- cement %>% 
  ggplot(aes(key, value)) +
  geom_boxplot() +
  stat_summary(fun.y = mean, geom = "point", shape = 4, color = "red") +
  coord_flip() +
  labs(x = NULL, y = 'Strength') +
  theme(axis.text.y.left = element_text(angle = 90, hjust = 0.5))
plt
```

```{r}
head(Portlandcement, 3)
```


]
.right-column[
### Two sample t-test
```{r}
with(Portlandcement, mixlm::t_test(Modified, Unmodified, var.equal = TRUE))
```

### ANOVA test
```{r}
mdl <- mixlm::lm(value ~ key, data = cement)
mixlm::anova_reg(mdl)
```


]

---

.left-column[
# $\chi^2$ Statistic
## Chisq Test

```{r, echo = FALSE, fig.width=4, out.width='100%', fig.asp=0.7, fig.retina=2}
d <- 18
alpha <- 0.025
lmt <- 50
chisq_plot <- ggplot(data.frame(x = 0:lmt), aes(x)) +
  stat_function(fun = dchisq, args = list(df = d)) +
  stat_function(fun = dchisq, args = list(df = d),
                xlim = c(0, qchisq(alpha, df = d, 
                                   lower.tail = TRUE)), 
                geom = "area") +
  stat_function(fun = dchisq, args = list(df = d),
                xlim = c(qchisq(alpha, df = d, 
                                lower.tail = FALSE), lmt), 
                geom = "area") +
  ggtitle(paste("Chisq-dist with", d, 
                "degree of freedom"),
          paste(alpha * 2, "level of significance")) +
  labs(x = "Chisq", y = NULL) +
  annotate(x = c(qchisq(alpha, df = d, lower.tail = FALSE), 
                 qchisq(alpha, df = d, lower.tail = TRUE)), 
           color = "red",
           ymin = 0, ymax = 0.025, geom = "linerange") +
  annotate(x = c(qchisq(alpha, df = d, lower.tail = FALSE), 
                 qchisq(alpha, df = d, lower.tail = TRUE)), 
           label = round(c(qchisq(alpha, df = d, lower.tail = FALSE),
                     qchisq(alpha, df = d, lower.tail = TRUE)), 3), 
                     geom = "text", y = 0.03, hjust = c(0, 1))
```
```{r, fig.width=3.5, out.width='90%', fig.asp = 1, fig.retina=2}
chisq_plot
```

<div class = "side-caption">
The shaded region covers .italics[5%] area of the curve.
</div>

]

.right-column[
### Variance Test

### Confidence Interval

### Example
]

---


.left-column[
# Test Statistic
## Chisq Test
]

.right-column[

]

---

.left-column[
# Test Statistic
## F Distribution
]

.right-column[
```{r, echo = FALSE, fig.width=4, out.width='100%', fig.asp=0.7, fig.retina=2}
d <- c(3, 15)
alpha <- 0.05
lmt <- 10
plt <- ggplot(data.frame(x = 0:lmt), aes(x)) +
  stat_function(fun = df, args = list(df1 = d[1], df2 = d[2]), n = 200) +
  stat_function(fun = df, args = list(df1 = d[1], df2 = d[2]), n = 200, 
                xlim = c(qf(alpha, df1 = d[1], df2 = d[2], lower.tail = FALSE), lmt), 
                geom = "area") +
  ggtitle(paste("F-distribution with", paste(d, collapse = " and "), "df"),
          paste(alpha, "level of significance")) +
  labs(x = "F", y = "f(F)") +
  annotate(x = qf(alpha, df1 = d[1], df2 = d[2], lower.tail = FALSE),
           color = "red",
           ymin = 0, ymax = 0.1, geom = "linerange") +
  annotate(x = qf(alpha, df1 = d[1], df2 = d[2], lower.tail = FALSE),
           label = paste("F =", round(qf(alpha, df1 = d[1], df2 = d[2], lower.tail = FALSE), 3)), 
           geom = "text", y = 0.15, hjust = 0)
plt
```
]

---

.left-column[
# Test Statistic
## Chisq Test
]

.right-column[

]


